{% extends "base.html" %}

{% block title %}Inventario{% endblock %}

{% block content %}
<div class="container my-4">
<div class="d-flex justify-content-between align-items-center mb-3">
  <h2 class="mb-0">Inventario de productos</h2>
  <div>
      <a href="{% url 'inventario:categorias_lista' %}" class="btn btn-outline-secondary me-2">
        Gestionar categorías
      </a>
      <a href="{% url 'inventario:importar' %}" class="btn btn-outline-secondary me-2">
        Importar CSV
      </a>
      <a href="{% url 'inventario:crear' %}" class="btn btn-primary">
        + Nuevo producto
      </a>
  </div>
</div>


  <form method="get" class="row g-2 mb-3">

  <!-- Buscador -->
  <div class="col-md-4">
    <input type="text"
           name="q"
           class="form-control"
           placeholder="Buscar por nombre o SKU..."
           value="{{ request.GET.q }}">
  </div>

  <!-- Filtro por categoría -->
  <div class="col-md-3">
    <select name="categoria" class="form-select">
      <option value="todas">Todas las categorías</option>
      {% for cat in categorias %}
        <option value="{{ cat.id }}"
          {% if categoria_seleccionada|stringformat:"s" == cat.id|stringformat:"s" %}selected{% endif %}>
          {{ cat.nombre }}
        </option>
      {% endfor %}
    </select>
  </div>

  <!-- Filtro por estado -->
  <div class="col-md-3">
    <select name="estado" class="form-select">
      <option value="todos" {% if estado_seleccionado == "todos" %}selected{% endif %}>
        Todos los estados
      </option>
      <option value="activos" {% if estado_seleccionado == "activos" %}selected{% endif %}>
        Activos
      </option>
      <option value="inactivos" {% if estado_seleccionado == "inactivos" %}selected{% endif %}>
        Inactivos
      </option>
    </select>
  </div>

  <!-- Botón -->
  <div class="col-md-2 d-grid">
    <button type="submit" class="btn btn-outline-secondary">
      Filtrar
    </button>
  </div>

</form>


  <!-- Tabla de productos -->
  <div class="card shadow-sm">
    <div class="card-body p-0">
      <table class="table table-hover mb-0 align-middle">
        <thead class="table-light">
          <tr>
            <th>SKU</th>
            <th>Nombre</th>
            <th>Categoría</th>
            <th class="text-end">Precio</th>
            <th class="text-center">Stock</th>
            <th>Estado</th>
            <th class="text-end">Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% for p in productos %}
          <tr>
            <td class="text-muted">{{ p.sku }}</td>
            <td>
              {{ p.nombre }}
              {% if p.stock <= p.stock_minimo %}
                <span class="badge bg-danger ms-1">Stock bajo</span>
              {% endif %}
            </td>
            <td>
              {% if p.categoria %}
                <span class="badge bg-secondary">{{ p.categoria.nombre }}</span>
              {% else %}
                <span class="text-muted">Sin categoría</span>
              {% endif %}
            </td>
            <td class="text-end">
              ${{ p.precio_unitario|floatformat:0 }}
            </td>
            <td class="text-center">
              {% if p.stock <= p.stock_minimo %}
                <span class="text-danger fw-bold">{{ p.stock }}</span>
              {% else %}
                {{ p.stock }}
              {% endif %}
              <div class="small text-muted">
                mín: {{ p.stock_minimo }}
              </div>
            </td>
            <td>
              {% if p.activo %}
                <span class="badge bg-success">Activo</span>
              {% else %}
                <span class="badge bg-secondary">Inactivo</span>
              {% endif %}
            </td>
            <td class="text-end">
              <a href="{% url 'inventario:editar' p.pk %}" class="btn btn-sm btn-outline-primary">
                Editar
              </a>
              <a href="{% url 'inventario:eliminar' p.pk %}"
                 class="btn btn-sm btn-outline-danger"
                 onclick="return confirm('¿Seguro que deseas eliminar/desactivar este producto?');">
                Eliminar
              </a>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="7" class="text-center text-muted py-4">
              No se encontraron productos con los filtros seleccionados.
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

</div>
{% endblock %}
